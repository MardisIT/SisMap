
@{
    ViewBag.Title = "Index";
}

<div id="contentRequestPermisson" class="dialogModal">
    <a id="requestPermisson" class="waves-effect waves-light btn" style="background-color:#007ACC">VER BANCOS DEL BARRIO</a>
    <div id="progressCircle" class="preloader-wrapper big active progressMap">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div><div class="gap-patch">
                <div class="circle"></div>
            </div><div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>
</div>

<nav class="navPage">
    <i id="openAllSites" class="material-icons">menu</i>
    <!--
    <img src="~/Content/img/mardis.png" class="iconHeader" />
        -->
    <div id="getNearest" class="getNearest" style="display:flex; flex-direction:row; align-content:center; align-items:center; justify-content:space-around">
        <b class="nearestText">Banco más cercano</b>
        <i class="material-icons">directions</i>
    </div>


    <!--
        <div id="routeResumen" class="routeResumen">
            <p>
                DISTANCIA: <a id="distace"></a>
                TIEMPO: <a id="duration"></a>
            </p>
        </div>
     -->
</nav>
<style>
    .sidenav-overlay {
    opacity:0 !important;


    }
    .sidenav_bg {
    position: fixed;
    width: 450px;
    left: 78%;
    top: 0;
    margin: 0;
    -webkit-transform: translateX(-100%);
    transform: translateX(-100%);
    height: 650px;

    height: -moz-calc(100%);
    padding-bottom: 60px;
    background-color: #fff;
    z-index: 999;
    overflow-y: auto;
    will-change: transform;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-transform: translateX(-105%);
    transform: translateX(-105%);
}
    #table-mardis_length {
    display:none!important;
    }
     #table-mardis_info {
    display:none!important;
    }
    .dataTables_wrapper .dataTables_paginate {
    float: none !important;
    text-align: center  !important;

}
  table.dataTable thead th, table.dataTable thead td {

    border-bottom: none !important;
}

    .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        color: #fff !important;
        border: 1px solid #be1c6c !important;
        background: #be1c6c !important;
    }
    #table-mardis_filter {
     float: none !important;
    text-align: center  !important;
    }
    .pink {
    background-color: #be1c6c !important;
    color: white !important;
}
    #table-mardis_filter input {
    width:300px;
    }   
    .lever {
    background-color: #0288d1 !important;
    color: white !important;
}
    .switch label input[type=checkbox]:checked + .lever:after {
    background-color: white  !important;
}
</style>
<main class="map" id="mapid">
</main>
@Html.AntiForgeryToken()
<!--MARKER DRAWER-->
<aside id="markerSite" class="sidenav drawerBackground">
    <!--MARKER NAVBAR-->
    <img src="~/Content/img/CABECERA_BDB.png" class="cabeceraImage" />
    <div class="TITLEBRAND">
        <p class="titleText">NOMBRE DEL NEGOCIO</p>
    </div>
    <nav class="drawerNavigator" style="background-color: #BE1C6C">
        <span>
            <i id="closeDrawer" class=" lbar material-icons">arrow_back</i><p style="position: inherit;top: -10px;font-size: 12px;"> Regresar</p>
        </span>


        <p id="titleDrawer" class="titleText"></p>

        <span>
            <i id="goTo" class="ibar material-icons">directions</i><p style="position: inherit;top: -10px;font-size: 12px;"> Cómo llegar</p>
        </span>

    </nav>
    <ul class="drawerBody">
        @*<img id=localImage src="" class="imageHeader" hidden>*@
        @*<div>
                NOMBRE DEL NEGOCIO
                <p id="localName"></p>
            </div>*@
        <div>
            TIPO DE NEGOCIO
            <p id="localType"></p>
        </div>
        <!--
            <div>
                PROPIETARIO
                <p id="localOwn"></p>
            </div>

        <div>
            TELÉFONO
            <p id="localPhone"></p>
        </div>
        -->
        <div>
            DIRECCIÓN
            <p id="localDir"></p>
        </div>
        @*<div>
                PROVINCIA
                <p id="localProv"></p>
            </div>*@
        <div>
            CANTÓN
            <p id="localCity"></p>
        </div>
        <div>
            PARROQUIA
            <p id="localPar"></p>
        </div>
        <div style="display: none;">
            LATITUD
            <p id="localLat"></p>
        </div>
        <div style="display: none;">
            LONGITUD
            <p id="localLong"></p>
        </div>
        @*<div class="TITLEBRANDTI">
                <H6><strong>SERVICIOS</strong></H6>
            </div>*@

        @*<div style="text-align:center">
                <img src="~/Content/img/LOGO_BG.png" class="imageFooterBG" />
            </div>*@
    </ul>
    <div style="text-align:center">

        <img src="~/Content/img/SERVICIOS_BDB.jpg" class="imageFooter" />
    </div>
</aside>
<!--LIST DRAWER-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<aside id="allsites" class="sidenav">
    <nav class="navPageAll" style="background-color: #BE1C6C">
        <p> Banco Guayaquil</p>

    </nav>

    <div class="container">
        <h5>Encuentre Agencia, cajero o Banco de barrio</h5>

        <form>
            <div class="form-check-inline">
                <p>
                    <label>
                        <input type="checkbox" class="OptionService" id="bdb1" checked="checked" />
                        <span>Banco del Barrio</span>
                    </label>
                </p>
            </div>
            <div class="form-check-inline">
                <p>
                    <label>
                        <input type="checkbox" class="OptionService" id="mtf1" checked="checked" />
                        <span>Multifunciones</span>
                    </label>
                </p>
            </div>
            <div class="form-check-inline">
                <p>
                    <label>
                        <input type="checkbox" class="OptionService" id="agc1" checked="checked" />
                        <span>Agencias</span>
                    </label>
                </p>
            </div>
            <div class="form-check-inline">
                <p>
                    <label>
                        <input type="checkbox" class="OptionService" id="atm1" checked="checked" />
                        <span>ATMs</span>
                    </label>
                </p>
            </div>

        </form>
        <ul id="listCollapsible" class="collapsible">
        </ul>
    </div>
   
</aside>
<!--
    <div style="display:none;overflow-y: auto;" class="floatSteps" id="floatSteps">
        <ul id="floatStepsBody" class="floatStepsBody">
        </ul>
    </div>

<a class="menuSteps" id="menuSteps"><i class="material-icons">directions</i></a>
-->

<div class="container">

    <div class="row sidenav_bg  right-aligned" style="    margin-left: -3%; transform: translateY(20%);    border-radius: 10px;">
        <nav class="navPageAll" style="        background-color: #BE1C6C">
            <p> Encuentre Agencia, cajero o Banco de barrio</p>

        </nav>


        <div class="col s12 m6" style=" top:10px;">
            <div>
                <div class="card-content white-text">
                    <div class="col s12 m6">

                        <div class="switch" style=" float: right; text-align: right;">
                            <label>
                                Bancos de barrio
                                <input type="checkbox" class="OptionService" id="bdb" checked="checked">
                                <span class="lever"></span>
                            </label>
                        </div>
                    </div>
                    <div class="col s12 m6">

                        <div class="switch" style="    float: right;    text-align: right;">
                            <label>
                                Multifunciones
                                <input type="checkbox" class="OptionService" id="mtf" checked="checked">
                                <span class="lever"></span>
                            </label>
                        </div>
                    </div>
                    <div class="col s12 m6" style="    float: right;    text-align: right;">

                        <div class="switch">
                            <label>
                                Agencias
                                <input type="checkbox" class="OptionService" id="agc" checked="checked">
                                <span class="lever"></span>
                            </label>
                        </div>
                    </div>
                    <div class="col s12 m6" style="    float: right;    text-align: right;">
                        <div class="switch">
                            <label>
                                ATMs
                                <input type="checkbox" class="OptionService" id="atm" checked="checked">
                                <span class="lever"></span>
                            </label>
                        </div>
                    </div>


                </div>
                <div class="col s12 m6">

                    <select id="selectProvice" class="browser-default">
                        <option value="" disabled selected>Provincia</option>
                    </select>
                </div>
                <div class="col s12 m6">

                    <select id="selectCities" class="browser-default">
                        <option value="" disabled selected>Ciudad</option>
                    </select>
                </div>
                <div class="col s9">
                    <div class="row">
                        <div class="input-field col s12">
                            <i class="material-icons prefix">search</i>
                            @*<input type="text" id="autocomplete-input" class="autocomplete">
                                <label for="autocomplete-input">Buscar</label>*@

                        </div>
                    </div>
                </div>
                @*<div class="col s3">
                        <div class="row">
                            <div class="input-field col s12">

                                <a class="waves-effect pink btn-small" style=" top: 50%;">Buscar</a>
                            </div>
                        </div>
                    </div>*@
                <div class="col s12" style="
        height: 300PX
" id="allSitesList">
                    <div id="DatosTabla" style="
        transform: translateY(-10%);
   ">
                        <table id="table-mardis" class="display">
                            <thead style="color:white">
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>

                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>




        </div>
        <div class="tooltip">

            <i id="getMyLocation" class="material-icons getMyLocation">gps_fixed</i>
            <span class="tooltiptext tooltip-left">Mi ubicación</span>

        </div>



    </div>
    @section scripts{
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        @*<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>*@
        <script src="~/Content/js/mainBancos.js"></script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165708090-1"></script>

        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'UA-165708090-1');
        </script>



        <script>

            $(document).ready(function () {
                $('#selectProvice').change(function () {
                    let _model = StoreData.find(x => x.Provice === $(this).val());
                    $('#selectCities').children().remove();
                    $('#selectCities').append('<option value="" disabled selected>Ciudad</option>')
                    $.each(_model.Cites, function (i, item) {
                        $('#selectCities').append($('<option>', {
                            value: item.City,
                            text: item.City
                        }));
                    });

                });
                $('#selectCities').change(function () {

                    LoadListbank($(this).val())

                });
                   $('#selectCities').change(function () {

                    LoadListbank($(this).val())

                });

        
            });


            function checkMobile() {
                return /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            }

            var checkDevice = checkMobile();

            if (window.location !== window.parent.location) {

                var contentRequestPermisson = document.getElementById('contentRequestPermisson')
                contentRequestPermisson.style.display = "flex"

                var myLocationButton = document.getElementById('getNearest')
                myLocationButton.style.display = "none";

                var myLocationButton = document.getElementById('getMyLocation')
                myLocationButton.style.display = "none";


                document.getElementById('requestPermisson').onclick = function () {

                    if (!checkDevice) {
                        var requestPermissonButton = document.getElementById('requestPermisson')
                        requestPermissonButton.style.display = "none"
                        var progressCircle = document.getElementById('progressCircle')
                        progressCircle.style.display = "flex"
                        LoadMap();
                    } else {
                        window.open('https://bancoguayaquil.azurewebsites.net/');
                    }
                }
            } else {

                var contentRequestPermisson = document.getElementById('contentRequestPermisson')
                contentRequestPermisson.style.display = "flex"

                var requestPermissonButton = document.getElementById('requestPermisson')
                requestPermissonButton.style.display = "none"

                var progressCircle = document.getElementById('progressCircle')
                progressCircle.style.display = "flex"

                var myLocationButton = document.getElementById('getNearest')
                myLocationButton.style.display = "none";

                var myLocationButton = document.getElementById('getMyLocation')
                myLocationButton.style.display = "none";
                LoadProvice();
                LoadMap();
            }


            function LoadMap() {

                GetGeo();
                var token = $("[name='__RequestVerificationToken']").val();
                // let _bdb = $('#bdb').prop('checked')


                let _bdb =  $('#bdb').prop('checked')
                let _mtf = $('#mtf').prop('checked')
                let _agc = $('#agc').prop('checked')
                let _atm = $('#atm').prop('checked')
                let geos = localStorage.getItem('Lat') + ";" + localStorage.getItem('lng')
             
                var dataSet = []
                $.ajax({
                    url: "/Bancos/DataMax",
                    type: 'POST',
                    data: {
                        __RequestVerificationToken: token,
                        mlf: _mtf,
                        bdb: _bdb,
                        agc: _agc,
                        atm: _atm,
                        lat: parseFloat(localStorage.getItem('Lat')),
                        lgn: parseFloat(localStorage.getItem('lng'))
                    },
                    success: function (result) {
                
                        result.map((dataResponse) => {

                            dataResponse.bancos.map((bancos) => {
                                var dataSet2 = []
                                let data = {
                                    nombre: "<b style='color:#1a237e;' onclick="+" 'ir("+bancos.latitud+","+bancos.longitud+")'"+">" + bancos.name + "</b></br><small>" + bancos.direccion + "</small> ",
                                    icon: '     <i class="material-icons pink prefix">adjust</i>  ',
                                    dist: "</br><small style='color:grey;'>" + bancos.distancia + " Km" + "</small> "
                                };

                                dataSet.push(data)
                            })
                        })


                        $('#table-mardis').DataTable({
                            "language": {
                                "url": "../Content/css/Latin.json"
                            },
                            data: dataSet,
                            "scrollY": "290px",
                            ordering: false,

                            "pageLength": 100,


                            //  searching: false,
                            columns: [
                                { "data": "icon" },
                                { "data": "nombre" },
                                { "data": "dist" }

                            ]


                        });
                        permiso(result)
                    },
                    error: function () {
                        if (window.location !== window.parent.location) {
                            var requestPermissonButton = document.getElementById('requestPermisson')
                            requestPermissonButton.style.display = "flex"

                            var progressCircle = document.getElementById('progressCircle')
                            progressCircle.style.display = "none"
                        } else {

                        }

                    }
                });
                return null;
            } function ir(lt, lg) {
                zoomPunto(lt, lg);
            }
                var latf;
                        var lngf;
            function LoadListbank(ct) {
                   

                var token = $("[name='__RequestVerificationToken']").val();
                let _bdb = document.getElementById("bdb").checked
                let _mtf = $('#mtf').prop('checked');
                let _agc = $('#agc').prop('checked');
                let _atm = $('#atm').prop('checked');

                let city = ct
                var dataSet = []
                $.ajax({
                    url: "/Bancos/DataMax",
                    type: 'POST',
                    async:true,
                    data: {
                        __RequestVerificationToken: token,
                        mlf: _mtf,
                        bdb: _bdb,
                        agc: _agc,
                        atm: _atm,
                        city: city,
                        lat: parseFloat(localStorage.getItem('Lat')),
                        lgn: parseFloat(localStorage.getItem('lng'))
                    },
                    success: function (result) {
                  
                        let cont=0
                        result.map((dataResponse) => {

                            dataResponse.bancos.map((bancos) => {
                                var dataSet2 = []
                                let data = {
                               nombre: "<b style='color:#1a237e;' onclick="+" 'ir("+bancos.latitud+","+bancos.longitud+")'"+">" + bancos.name + "</b></br><small>" + bancos.direccion + "</small> ",
                                    icon: '     <i class="material-icons pink prefix">adjust</i>  ',
                                    dist: "</br><small style='color:grey;'>" + bancos.distancia + " Km" + "</small> "
                                };

                                dataSet.push(data)
                                if (cont === 0) 
                                    {
                                        latf = bancos.latitud;
                                        lngf = bancos.longitud;
                                    }
                                    cont++;

                            })
                        })


                        $('#table-mardis').DataTable().destroy();
                       $('#table-mardis').DataTable({
                            "language": {
                                "url": "../Content/css/Latin.json"
                            },
                            data: dataSet,
                            "scrollY": "290px",
                            ordering: false,

                            "pageLength": 100,


                            //  searching: false,
                            columns: [
                                { "data": "icon" },
                                { "data": "nombre" },
                                { "data": "dist" }

                            ]
                      

                       });
                   
                        changedata(result)
                        
                   
                    },
                
                    error: function () {
                        if (window.location !== window.parent.location) {
                            var requestPermissonButton = document.getElementById('requestPermisson')
                            requestPermissonButton.style.display = "flex"

                            var progressCircle = document.getElementById('progressCircle')
                            progressCircle.style.display = "none"
                        } else {

                        }

                    }
                });
                return null;
            }


            function LoadProvice() {
                var token = $("[name='__RequestVerificationToken']").val();
                $.ajax({
                    url: "/Bancos/Provice",
                    type: 'POST',
                    data: {
                        __RequestVerificationToken: token
                    },
                    success: function (result) {
                        StoreData = result
                        $.each(StoreData, function (i, item) {
                            $('#selectProvice').append($('<option>', {
                                value: item.Provice,
                                text: item.Provice
                            }));
                        });
                    },
                    error: function () {
                        if (window.location !== window.parent.location) {
                            var requestPermissonButton = document.getElementById('requestPermisson')
                            requestPermissonButton.style.display = "flex"

                            var progressCircle = document.getElementById('progressCircle')
                            progressCircle.style.display = "none"
                        } else {

                        }

                    }
                });
                return null;
            }

            function ReadMap() {

                var token = $("[name='__RequestVerificationToken']").val();
                let _bdb = $('#bdb').prop('checked')
                let _mtf = $('#mtf').prop('checked')
                let _agc = $('#agc').prop('checked')
                let _atm = $('#atm').prop('checked')

                $.ajax({
                    url: "/Bancos/DataMax",
                    type: 'POST',
                    data: {
                        __RequestVerificationToken: token,
                        mlf: _mtf,
                        bdb: _bdb,
                        agc: _agc,
                        atm: _atm

                    },
                    success: function (result) {
                        changedata(result)
                    },
                    error: function () {
                        if (window.location !== window.parent.location) {
                            var requestPermissonButton = document.getElementById('requestPermisson')
                            requestPermissonButton.style.display = "flex"

                            var progressCircle = document.getElementById('progressCircle')
                            progressCircle.style.display = "none"
                        } else {

                        }

                    }
                });
                return null;
            }
            $(".OptionService").change(function () {

                LoadListbank($('#selectCities').val())
        
            })
        </script>
    }
